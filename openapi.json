{
    "swagger": "2.0",
    "info": {
        "title": "OpenAPI Document on Azure Functions",
        "description": "This is the OpenAPI Document on Azure Functions",
        "version": "1.0.0"
    },
    "host": "localhost:55590",
    "basePath": "/api",
    "schemes": ["http"],
    "paths": {
        "/users": {
            "post": {
                "tags": ["Users"],
                "summary": "Create or ensure user exists",
                "description": "Creates a new user record or returns the existing user. Call this after successful authentication to ensure the user exists in the system.",
                "operationId": "CreateUser",
                "produces": ["application/json"],
                "responses": {
                    "200": {
                        "description": "User created or already exists",
                        "schema": {
                            "$ref": "#/definitions/createUserResponse"
                        }
                    },
                    "401": {
                        "description": "User is not authenticated"
                    }
                }
            }
        },
        "/users/me": {
            "get": {
                "tags": ["User"],
                "summary": "Get current authenticated user",
                "description": "Returns information about the currently authenticated user",
                "operationId": "GetCurrentUser",
                "produces": ["application/json"],
                "responses": {
                    "200": {
                        "description": "Current user information",
                        "schema": {
                            "$ref": "#/definitions/currentUserResponse"
                        }
                    }
                }
            },
            "put": {
                "tags": ["Users"],
                "summary": "Update user fields",
                "description": "Updates the current user's fields such as name and onboarding status.",
                "operationId": "UpdateUser",
                "consumes": ["application/json"],
                "produces": ["application/json"],
                "parameters": [
                    {
                        "in": "body",
                        "name": "body",
                        "description": "The fields to update",
                        "schema": {
                            "$ref": "#/definitions/updateUserRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "User updated successfully",
                        "schema": {
                            "$ref": "#/definitions/updateUserResponse"
                        }
                    },
                    "401": {
                        "description": "User is not authenticated"
                    },
                    "404": {
                        "description": "User not found"
                    }
                }
            }
        },
        "/statistics/net-worth": {
            "get": {
                "tags": ["Statistics"],
                "summary": "Get net worth history",
                "description": "Retrieves the daily net worth history for the current authenticated user.",
                "operationId": "GetNetWorthHistory",
                "produces": ["application/json"],
                "responses": {
                    "200": {
                        "description": "Successfully retrieved net worth history",
                        "schema": {
                            "$ref": "#/definitions/netWorthHistoryResponse"
                        }
                    },
                    "401": {
                        "description": "User is not authenticated"
                    }
                }
            }
        },
        "/requisitions/{requisitionId}": {
            "get": {
                "tags": ["Requisitions"],
                "summary": "Get requisition",
                "description": "Retrieves the details of a specific requisition by ID.",
                "operationId": "GetRequisition",
                "produces": ["application/json"],
                "parameters": [
                    {
                        "in": "path",
                        "name": "requisitionId",
                        "description": "The requisition ID",
                        "required": true,
                        "type": "string"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Successfully retrieved requisition",
                        "schema": {
                            "$ref": "#/definitions/requisitionResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid requisition ID"
                    },
                    "404": {
                        "description": "Requisition not found"
                    },
                    "500": {
                        "description": "Internal server error"
                    }
                }
            }
        },
        "/institutions": {
            "get": {
                "tags": ["Institutions"],
                "summary": "Get financial institutions",
                "description": "Retrieves a list of available financial institutions for account linking. Already linked institutions are excluded.",
                "operationId": "GetInstitutions",
                "produces": ["application/json"],
                "responses": {
                    "200": {
                        "description": "Successfully retrieved institutions",
                        "schema": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/institutionResponse"
                            }
                        }
                    },
                    "500": {
                        "description": "Internal server error"
                    }
                }
            }
        },
        "/institutions/{institutionId}/link": {
            "post": {
                "tags": ["Institutions"],
                "summary": "Link institution",
                "description": "Links an institution by creating an agreement with the financial institution and then creating a requisition for account access.",
                "operationId": "LinkInstitution",
                "produces": ["application/json"],
                "parameters": [
                    {
                        "in": "path",
                        "name": "institutionId",
                        "description": "The institution ID to link",
                        "required": true,
                        "type": "string"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Successfully linked institution",
                        "schema": {
                            "$ref": "#/definitions/linkInstitutionResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid request parameters"
                    },
                    "500": {
                        "description": "Internal server error"
                    }
                }
            }
        },
        "/institutions/{institutionId}/sync": {
            "post": {
                "tags": ["Institutions"],
                "summary": "Sync institution accounts",
                "description": "Enqueues sync operations for all accounts belonging to the specified institution for the authenticated user.",
                "operationId": "SyncInstitution",
                "parameters": [
                    {
                        "in": "path",
                        "name": "institutionId",
                        "description": "The institution ID to sync",
                        "required": true,
                        "type": "string"
                    }
                ],
                "responses": {
                    "202": {
                        "description": "Successfully enqueued institution sync"
                    },
                    "400": {
                        "description": "Invalid request parameters"
                    },
                    "401": {
                        "description": "User is not authenticated"
                    },
                    "500": {
                        "description": "Internal server error"
                    }
                }
            }
        },
        "/accounts/{accountId}": {
            "get": {
                "tags": ["Accounts"],
                "summary": "Get account metadata",
                "description": "Retrieves the metadata for a specific bank account.",
                "operationId": "GetAccount",
                "produces": ["application/json"],
                "parameters": [
                    {
                        "in": "path",
                        "name": "accountId",
                        "description": "The account ID",
                        "required": true,
                        "type": "string"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Successfully retrieved account metadata",
                        "schema": {
                            "$ref": "#/definitions/accountResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid account ID"
                    },
                    "404": {
                        "description": "Account not found"
                    },
                    "500": {
                        "description": "Internal server error"
                    }
                }
            },
            "put": {
                "tags": ["Accounts"],
                "summary": "Update account fields",
                "description": "Updates an account's user-defined fields such as display name and account type.",
                "operationId": "UpdateAccount",
                "consumes": ["application/json"],
                "produces": ["application/json"],
                "parameters": [
                    {
                        "in": "path",
                        "name": "accountId",
                        "description": "The account ID",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "in": "body",
                        "name": "body",
                        "description": "The fields to update",
                        "schema": {
                            "$ref": "#/definitions/updateAccountRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Account updated successfully",
                        "schema": {
                            "$ref": "#/definitions/userAccountResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid request"
                    },
                    "401": {
                        "description": "User is not authenticated"
                    },
                    "404": {
                        "description": "Account not found"
                    }
                }
            }
        },
        "/accounts/{accountId}/balances": {
            "get": {
                "tags": ["Accounts"],
                "summary": "Get account balances",
                "description": "Retrieves the current balances for a specific bank account.",
                "operationId": "GetAccountBalances",
                "produces": ["application/json"],
                "parameters": [
                    {
                        "in": "path",
                        "name": "accountId",
                        "description": "The account ID",
                        "required": true,
                        "type": "string"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Successfully retrieved account balances",
                        "schema": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/accountBalanceResponse"
                            }
                        }
                    },
                    "400": {
                        "description": "Invalid account ID"
                    },
                    "404": {
                        "description": "Account not found"
                    },
                    "500": {
                        "description": "Internal server error"
                    }
                }
            }
        },
        "/accounts/{accountId}/details": {
            "get": {
                "tags": ["Accounts"],
                "summary": "Get account details",
                "description": "Retrieves detailed information for a specific bank account including owner details and account properties.",
                "operationId": "GetAccountDetails",
                "produces": ["application/json"],
                "parameters": [
                    {
                        "in": "path",
                        "name": "accountId",
                        "description": "The account ID",
                        "required": true,
                        "type": "string"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Successfully retrieved account details",
                        "schema": {
                            "$ref": "#/definitions/accountDetailResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid account ID"
                    },
                    "404": {
                        "description": "Account not found"
                    },
                    "500": {
                        "description": "Internal server error"
                    }
                }
            }
        },
        "/accounts": {
            "get": {
                "tags": ["Accounts"],
                "summary": "Get user accounts",
                "description": "Retrieves all bank accounts owned by the current authenticated user.",
                "operationId": "GetAccounts",
                "produces": ["application/json"],
                "responses": {
                    "200": {
                        "description": "Successfully retrieved user accounts",
                        "schema": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/userAccountResponse"
                            }
                        }
                    },
                    "401": {
                        "description": "User is not authenticated"
                    },
                    "500": {
                        "description": "Internal server error"
                    }
                }
            }
        },
        "/accounts/{accountId}/transactions": {
            "get": {
                "tags": ["Accounts"],
                "summary": "Get account transactions",
                "description": "Retrieves paginated transactions for a specific bank account.",
                "operationId": "GetAccountTransactions",
                "produces": ["application/json"],
                "parameters": [
                    {
                        "in": "path",
                        "name": "accountId",
                        "description": "The account ID",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "in": "query",
                        "name": "page",
                        "description": "Page number (1-based, default: 1)",
                        "type": "integer",
                        "format": "int32"
                    },
                    {
                        "in": "query",
                        "name": "pageSize",
                        "description": "Number of items per page (default: 50, max: 100)",
                        "type": "integer",
                        "format": "int32"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Successfully retrieved paginated account transactions",
                        "schema": {
                            "$ref": "#/definitions/pagedResponse_transactionResponse"
                        }
                    },
                    "400": {
                        "description": "Invalid parameters"
                    },
                    "404": {
                        "description": "Account not found"
                    },
                    "500": {
                        "description": "Internal server error"
                    }
                }
            }
        }
    },
    "definitions": {
        "accountBalanceResponse": {
            "type": "object",
            "properties": {
                "amount": {
                    "format": "double",
                    "type": "number"
                },
                "currency": {
                    "type": "string"
                },
                "balanceType": {
                    "type": "string"
                },
                "creditLimitIncluded": {
                    "type": "boolean"
                },
                "referenceDate": {
                    "format": "date-time",
                    "type": "string"
                }
            }
        },
        "accountDetailResponse": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "string"
                },
                "currency": {
                    "type": "string"
                },
                "name": {
                    "type": "string"
                },
                "displayName": {
                    "type": "string"
                },
                "product": {
                    "type": "string"
                },
                "cashAccountType": {
                    "type": "string"
                },
                "status": {
                    "type": "string"
                }
            }
        },
        "accountResponse": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "string"
                },
                "institutionId": {
                    "type": "string"
                },
                "status": {
                    "type": "string"
                },
                "name": {
                    "type": "string"
                }
            }
        },
        "createUserResponse": {
            "type": "object",
            "properties": {
                "userId": {
                    "type": "string"
                },
                "name": {
                    "type": "string"
                },
                "isNewUser": {
                    "type": "boolean"
                },
                "hasCompletedOnboarding": {
                    "type": "boolean"
                }
            }
        },
        "currentUserResponse": {
            "type": "object",
            "properties": {
                "userId": {
                    "type": "string"
                },
                "name": {
                    "type": "string"
                },
                "isAuthenticated": {
                    "type": "boolean"
                }
            }
        },
        "institutionResponse": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "string"
                },
                "name": {
                    "type": "string"
                },
                "logoUrl": {
                    "type": "string"
                }
            }
        },
        "linkInstitutionResponse": {
            "type": "object",
            "properties": {
                "authorizationLink": {
                    "type": "string"
                },
                "status": {
                    "format": "int32",
                    "default": 0,
                    "enum": [0, 1, 2, 3, 4, 5],
                    "type": "integer"
                },
                "isAlreadyLinked": {
                    "type": "boolean"
                },
                "existingRequisitionId": {
                    "type": "string"
                }
            }
        },
        "netWorthHistoryResponse": {
            "type": "object",
            "properties": {
                "dataPoints": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/netWorthPointResponse"
                    }
                },
                "status": {
                    "format": "int32",
                    "default": 0,
                    "enum": [0, 1, 2],
                    "type": "integer"
                },
                "lastCalculated": {
                    "format": "date-time",
                    "type": "string"
                }
            }
        },
        "netWorthPointResponse": {
            "type": "object",
            "properties": {
                "date": {
                    "format": "date-time",
                    "type": "string"
                },
                "amount": {
                    "format": "double",
                    "type": "number"
                }
            }
        },
        "pagedResponse_transactionResponse": {
            "type": "object",
            "properties": {
                "items": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/transactionResponse"
                    }
                },
                "page": {
                    "format": "int32",
                    "type": "integer"
                },
                "pageSize": {
                    "format": "int32",
                    "type": "integer"
                },
                "totalCount": {
                    "format": "int32",
                    "type": "integer"
                },
                "totalPages": {
                    "format": "int32",
                    "type": "integer"
                },
                "hasNextPage": {
                    "type": "boolean"
                },
                "hasPreviousPage": {
                    "type": "boolean"
                }
            }
        },
        "requisitionResponse": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "string"
                },
                "status": {
                    "type": "string"
                },
                "institutionId": {
                    "type": "string"
                },
                "agreementId": {
                    "type": "string"
                },
                "reference": {
                    "type": "string"
                },
                "accounts": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "authenticationLink": {
                    "type": "string"
                }
            }
        },
        "transactionResponse": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "string"
                },
                "accountId": {
                    "type": "string"
                },
                "transactionId": {
                    "type": "string"
                },
                "amount": {
                    "format": "double",
                    "type": "number"
                },
                "currency": {
                    "type": "string"
                },
                "bookingDate": {
                    "format": "date-time",
                    "type": "string"
                },
                "valueDate": {
                    "format": "date-time",
                    "type": "string"
                },
                "creditorName": {
                    "type": "string"
                },
                "debtorName": {
                    "type": "string"
                },
                "creditorAccount": {
                    "type": "string"
                },
                "debtorAccount": {
                    "type": "string"
                },
                "remittanceInformationUnstructured": {
                    "type": "string"
                },
                "bankTransactionCode": {
                    "type": "string"
                },
                "proprietaryBankTransactionCode": {
                    "type": "string"
                },
                "endToEndId": {
                    "type": "string"
                },
                "mandateId": {
                    "type": "string"
                },
                "creditorId": {
                    "type": "string"
                },
                "ultimateCreditor": {
                    "type": "string"
                },
                "ultimateDebtor": {
                    "type": "string"
                },
                "purposeCode": {
                    "type": "string"
                },
                "additionalInformation": {
                    "type": "string"
                },
                "balanceAfterTransaction": {
                    "format": "double",
                    "type": "number"
                },
                "isPending": {
                    "type": "boolean"
                }
            }
        },
        "updateAccountRequest": {
            "type": "object",
            "properties": {
                "displayName": {
                    "type": "string"
                },
                "category": {
                    "format": "int32",
                    "default": 0,
                    "enum": [0, 1, 2],
                    "type": "integer"
                }
            }
        },
        "updateUserRequest": {
            "type": "object",
            "properties": {
                "name": {
                    "type": "string"
                },
                "hasCompletedOnboarding": {
                    "type": "boolean"
                }
            }
        },
        "updateUserResponse": {
            "type": "object",
            "properties": {
                "userId": {
                    "type": "string"
                },
                "name": {
                    "type": "string"
                },
                "hasCompletedOnboarding": {
                    "type": "boolean"
                }
            }
        },
        "userAccountResponse": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "string"
                },
                "userId": {
                    "type": "string"
                },
                "requisitionId": {
                    "type": "string"
                },
                "institutionId": {
                    "type": "string"
                },
                "institutionName": {
                    "type": "string"
                },
                "institutionLogo": {
                    "type": "string"
                },
                "name": {
                    "type": "string"
                },
                "displayName": {
                    "type": "string"
                },
                "category": {
                    "format": "int32",
                    "default": 0,
                    "enum": [0, 1, 2],
                    "type": "integer"
                },
                "iban": {
                    "type": "string"
                },
                "currency": {
                    "type": "string"
                },
                "product": {
                    "type": "string"
                },
                "lastSynced": {
                    "format": "date-time",
                    "type": "string"
                }
            }
        }
    }
}
